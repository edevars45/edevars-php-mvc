# === MVC avec /public comme front ===
# À mettre à la racine du projet (pas dans /public)
# Prérequis Apache : AllowOverride All (ou au moins FileInfo,Indexes),
# modules: mod_rewrite, mod_headers (facultatif pour les headers)

# Empêcher l’indexation des répertoires
Options -Indexes

# Bloquer l’accès aux fichiers/dossiers cachés (.env, .git, etc.)
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Si l’app est dans un sous-dossier (ex: /mon-app), décommentez et adaptez :
    # RewriteBase /mon-app

    # Protéger les répertoires/fichiers sensibles s’ils sont au-dessus de /public
    RewriteRule ^(app|config|vendor|tests|bin|var|storage)/ - [F,L,NC]
    RewriteRule ^(composer\.(json|lock)|package\.json|README\.md)$ - [F,L,NC]

    # Servir tels quels les fichiers ou répertoires existants (assets, uploads…)
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Tout le reste va vers le front controller
    RewriteRule ^ public/index.php [QSA,L]
</IfModule>

# (Optionnel) Forcer HTTPS — décommentez si nécessaire
# <IfModule mod_rewrite.c>
#   RewriteCond %{HTTPS} !=on
#   RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
# </IfModule>

# (Optionnel) Quelques en-têtes de sécurité
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Permissions-Policy "interest-cohort=()"
</IfModule>